<!---
  Copyright 2024 SECO Mind Srl
  SPDX-License-Identifier: Apache-2.0
-->
<!-- HTML header for doxygen 1.12.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Astarte device API for Zephyr: Astarte device API for Zephyr</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toc.js"></script>
<script type="text/javascript">
  DoxygenAwesomeInteractiveToc.init()
</script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeParagraphLink.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
  DoxygenAwesomeFragmentCopyButton.init()
</script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
  DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-astarte.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Astarte device API for Zephyr<span id="projectnumber">&#160;0.7.2</span>
   </div>
   <div id="projectbrief">Astarte device SDK for Zephyr RTOS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Astarte device API for Zephyr </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__2home_2runner_2work_2astarte-device-sdk-zephyr_2astarte-device-sdk-zephyr_2astarte-device-sdk-zephyr_2README"></a>    </p>
<h1><a class="anchor" id="autotoc_md0"></a>
Astarte Device SDK Zephyr</h1>
<p>Astarte device library for the Zephyr framework.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Getting started</h2>
<p>Before getting started, make sure you have a proper Zephyr development environment. Follow the official <a href="https://docs.zephyrproject.org/latest/getting_started/index.html">Zephyr Getting Started Guide</a>.</p>
<h3><a class="anchor" id="autotoc_md2"></a>
Using the library as a dependency in an application</h3>
<p>To add this module as a dependency to an application the application's <code>west.yml</code> manifest file should be modified in the following way. First, a new remote should be added: </p><div class="fragment"><div class="line">remotes:</div>
<div class="line">  # ... other remotes ...</div>
<div class="line">  - name: astarte-platform</div>
<div class="line">    url-base: https://github.com/astarte-platform</div>
</div><!-- fragment --><p> Second, a new entry should be added to the projects list: </p><div class="fragment"><div class="line">projects:</div>
<div class="line">  # ... other projects ...</div>
<div class="line">  - name: astarte-device-sdk-zephyr</div>
<div class="line">    remote: astarte-platform</div>
<div class="line">    repo-path: astarte-device-sdk-zephyr.git</div>
<div class="line">    path: astarte-device-sdk-zephyr</div>
<div class="line">    revision: v0.7.2</div>
<div class="line">    west-commands: scripts/west-commands.yml</div>
<div class="line">    import: true</div>
</div><!-- fragment --><p> Remember to run <code>west update</code> after performing changes to the manifest file.</p>
<p>In addition, the Astarte device library <code>Kconfig</code> should be added to the <code>Kconfig</code> file of the application. </p><div class="fragment"><div class="line">rsource &quot;../../astarte-device-sdk-zephyr/Kconfig&quot;</div>
</div><!-- fragment --><p> This will add the configuration options of the example module to the application.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Using the library as a standalone application</h3>
<p>For development or evaluation purposes the library can be used as a stand alone application in its own workspace. This will make it possible to build and execute the module samples without having to set up an extra application.</p>
<h4><a class="anchor" id="autotoc_md4"></a>
Creating a new workspace, venv and install west</h4>
<p>Start by creating a new workspace folder and a venv where <code>west</code> will reside.</p>
<div class="fragment"><div class="line">mkdir ~/astarte-zephyrproject &amp;&amp; cd ~/astarte-zephyrproject</div>
<div class="line">python3 -m venv .venv</div>
<div class="line">source .venv/bin/activate</div>
<div class="line">pip install west</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md5"></a>
Initializing the workspace</h4>
<p>The west workspace should be then intialized, using the Astarte libary repository as the manifest repository.</p>
<div class="fragment"><div class="line">west init -m git@github.com:astarte-platform/astarte-device-sdk-zephyr --mr master</div>
<div class="line">west update</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md6"></a>
Exporting zephyr environment and installing python dependencies</h4>
<p>Lastly some dependencies will need to be installed for all west extensions to work correctly.</p>
<div class="fragment"><div class="line">west zephyr-export</div>
<div class="line">west packages pip --install</div>
<div class="line">west packages pip --install -- -r ./astarte-device-sdk-zephyr/scripts/requirements.txt</div>
</div><!-- fragment --> <h4><a class="anchor" id="autotoc_md7"></a>
Fetching binary blobs for ESP32</h4>
<p>If building for an esp32 the binary blobs will need to be downloaded before building the application.</p>
<div class="fragment"><div class="line">west blobs fetch hal_espressif</div>
</div><!-- fragment --><p>Note: this command should be re-run when updating Zephyr to a newer version</p>
<h4><a class="anchor" id="autotoc_md8"></a>
Building and running a sample application</h4>
<p>To build one of the samples applications, run the following command:</p>
<div class="fragment"><div class="line">west build -p always -b &lt;BOARD&gt; ./astarte-device-sdk-zephyr/samples/&lt;SAMPLE&gt;</div>
</div><!-- fragment --><p>Where <code>&lt;BOARD&gt;</code> is one of the <a href="https://docs.zephyrproject.org/latest/boards/index.html">boards</a> supported by Zephyr and <code>&lt;SAMPLE&gt;</code> is one of the samples contained in the <code>samples</code> folder.</p>
<p>Once you have built the application, run the following command to flash it on the ESP board: </p><div class="fragment"><div class="line">west flash</div>
</div><!-- fragment --><p>Or the following command to run on an emulated board or the native simulator: </p><div class="fragment"><div class="line">west build -t run</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md9"></a>
One time configuration</h4>
<p>While usually the configuration setting are set in a <code>prj.conf</code> file, during development it might be useful to set them manually. To do so run the following command: </p><div class="fragment"><div class="line">west build -t menuconfig</div>
</div><!-- fragment --><p> This command will require the application to have already been build to function correctly. After changing the configuration, the application can be flashed directly using <code>west flash</code>.</p>
<h4><a class="anchor" id="autotoc_md10"></a>
Reading serial monitor</h4>
<p>The standard configuration for all the samples include settings for printing the logs through the serial port connected to the host.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Unit testing</h2>
<p>A set of unit test is present under the <code>tests</code> directory of this project. They can be run using twister. </p><div class="fragment"><div class="line">west twister -c -T ./astarte-device-sdk-zephyr/tests</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
West extension commands</h2>
<h3><a class="anchor" id="autotoc_md13"></a>
Interface definitions generation</h3>
<p>The standard format of an Astarte interface is a JSON file as defined in the <a href="https://docs.astarte-platform.org/astarte/latest/030-interface.html">Astarte documentation</a>. However, an Astarte device on Zephyr uses C structures to define Astarte interfaces. Translating an interface from a JSON definition to a C definition for Zephyr can be a repetitive and error-prone process.</p>
<p>For this reason, an extension command for <code>west</code> has been created to facilitate this procedure. The <code>generate-interfaces</code> extension command accepts as input one or more JSON interface definitions and automatically generates the corresponding C source code. Run <code>west generate-interfaces --help</code> to learn about the generation options.</p>
<h4><a class="anchor" id="autotoc_md14"></a>
Build time interface definitions generation</h4>
<p>It's also possible to automatically generate the interface definition structs. Generated files will be located in the build directory: <code>build/zephyr/include/generated/astarte_generated_interfaces.*</code>.</p>
<p>This allows an easier management of generated files that won't need to be committed to the vcs. Enabling the feature is straight forward and requires setting two configuration values in the project <code>prj.conf</code> file: </p><div class="fragment"><div class="line">CONFIG_ASTARTE_DEVICE_SDK_CODE_GENERATION=y</div>
<div class="line">CONFIG_ASTARTE_DEVICE_SDK_CODE_GENERATION_INTERFACE_DIRECTORY=&quot;&lt;interface jsons directory&gt;&quot;</div>
</div><!-- fragment --><p> Replace <code>&lt;interface jsons directory&gt;</code> with the relative path to the interfaces directory.</p>
<p>After adding the two properties you can run a build targeting <code>astarte_generate_interfaces</code>. </p><div class="fragment"><div class="line">west build -b native_sim -t astarte_generate_interfaces .</div>
</div><!-- fragment --><p> or simply launch a build of the project.</p>
<p>After this you'll be able to include the generated header file: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;astarte_generated_interfaces.h&quot;</span></div>
</div><!-- fragment --><p>For a complete example you can take a look at <code>e2e/prj.conf</code> and the <code>interfaces/</code> directory. The generated interfaces are included in <code>e2e/src/runner.c</code>.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Code formatting</h3>
<p>The code in this module is formatted using <code>clang-format</code>. An extension command for <code>west</code> has been created to facilitate formatting. Run <code>west format --help</code> to learn about the formatting options.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
Static code analysis</h3>
<p><a href="https://codechecker.readthedocs.io/en/latest/">CodeChecker</a> is the one of the <a href="https://docs.zephyrproject.org/latest/develop/sca/index.html">two</a> natively supported static analysis tools in <code>west</code>. It can be configured to run different static checkers, such as <code>clang-tidy</code> and <code>cppcheck</code>.</p>
<p>An extension command for <code>west</code> has been created to facilitate running static analysis with <code>clang-tidy</code>. Run <code>west static --help</code> to read what this command performs.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
Build doxygen documentation</h3>
<p>The dependencies for generating the doxygen documentation are:</p><ul>
<li><code>doxygen &lt;= 1.9.6</code></li>
<li><code>graphviz</code></li>
</ul>
<p>An extension command for <code>west</code> has been created to facilitate generating the documentation. Run <code>west docs --help</code> for more information on how to generate the documentation.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
VS Code integration</h2>
<p>Here are some quick tips to configure VS Code with a Zephyr workspace. Make sure the following extensions are installed:</p><ul>
<li>C/C++ Extension Pack</li>
<li>Python</li>
</ul>
<p>Create the file <code>./.vscode/settings.json</code> and fill it with the following content: </p><div class="fragment"><div class="line">{</div>
<div class="line">    // Hush CMake</div>
<div class="line">    &quot;cmake.configureOnOpen&quot;: false,</div>
<div class="line"> </div>
<div class="line">    // Configure Python so that each new terminal will activate the venv</div>
<div class="line">    // defaultInterpreterPath is not always be picked up, backup cmd: &#39;Python: select interpreter&#39;</div>
<div class="line">    &quot;python.defaultInterpreterPath&quot;: &quot;${workspaceFolder}/.venv/bin/python&quot;,</div>
<div class="line">    &quot;python.terminal.activateEnvironment&quot;: true,</div>
<div class="line">    &quot;python.terminal.activateEnvInCurrentTerminal&quot;: true,</div>
<div class="line"> </div>
<div class="line">    // IntelliSense</div>
<div class="line">    &quot;C_Cpp.default.compilerPath&quot;: &quot;${userHome}/zephyr-sdk-0.16.8/arm-zephyr-eabi/bin/arm-zephyr-eabi-gcc&quot;,</div>
<div class="line">    &quot;C_Cpp.default.compileCommands&quot;: &quot;${workspaceFolder}/build/compile_commands.json&quot;,</div>
<div class="line">    &quot;C_Cpp.autoAddFileAssociations&quot;: false,</div>
<div class="line">    &quot;C_Cpp.debugShortcut&quot;: false</div>
<div class="line">}</div>
</div><!-- fragment --><p> The first setting will avoid noisy popups from the CMake extension. The python related settings will ensure that each time the integrated terminal is open, the venv containing <code>west</code> will be automatically activated. The C/C++ settings will configure intellisense. Those setting might be slightly different for your specific Zephyr SDK installation as versions might change. Also, the compile commands path assumes <code>west build</code> gets run from the root of the zephyr workspace.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Architectural documentation</h2>
<p>Some additional documentation for the library architecture is available.</p><ul>
<li><a class="el" href="md__2home_2runner_2work_2astarte-device-sdk-zephyr_2astarte-device-sdk-zephyr_2astarte-device-sddef73e401b80b2170021b78ad2e458cc.html">Astarte MQTT client</a> is a soft wrapper around the MQTT client library from Zephyr. It extends the functionality of the standard MQTT client.</li>
<li><a class="el" href="md__2home_2runner_2work_2astarte-device-sdk-zephyr_2astarte-device-sdk-zephyr_2astarte-device-sd62dcd5f0d5ffd154d1c7edffea463ce9.html">Astarte device</a> is the main entry point for any interaction with Astarte. </li>
</ul>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
