<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Features definition" href="../features_def.html" /><link rel="prev" title="Get started with Rust" href="rust.html" />

    <link rel="shortcut icon" href="../_static/mascotte.svg"/><!-- Generated with Sphinx 8.0.2 and Furo 2024.08.06 -->
        <title>Get started with Zephyr - Astarte SDKs documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Astarte SDKs documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">Astarte SDKs documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../get_started.html">Getting started guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="c_esp32.html">Get started with C (ESP32)</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_qt5.html">Get started with C++ (Qt5)</a></li>
<li class="toctree-l2"><a class="reference internal" href="elixir.html">Get started with Elixir</a></li>
<li class="toctree-l2"><a class="reference internal" href="go.html">Get started with Go</a></li>
<li class="toctree-l2"><a class="reference internal" href="java_android.html">Get started with Java (Android)</a></li>
<li class="toctree-l2"><a class="reference internal" href="python.html">Get started with Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="rust.html">Get started with Rust</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Get started with Zephyr</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../features_def.html">Features definition</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_docs.html">API documentation</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of API documentation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api_docs/esp32.html">Esp32 APIs</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Esp32 APIs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/esp32/1.3/api">Esp32 v1.3 APIs</a></li>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/esp32/1.2/api">Esp32 v1.2 APIs</a></li>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/esp32/1.1/api">Esp32 v1.1 APIs</a></li>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/esp32/1.0/api">Esp32 v1.0 APIs</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api_docs/python.html">Python APIs</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Python APIs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/python/0.13/api">Python v0.13 APIs</a></li>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/python/0.12/api">Python v0.12 APIs</a></li>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/python/0.11/api">Python v0.11 APIs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/zephyr/0.7/api">Zephyr APIs</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../api_docs/java.html">Java APIs</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Java APIs</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/java/1.1/api">Java v1.1 APIs</a></li>
<li class="toctree-l3"><a class="reference external" href="https://docs.astarte-platform.org/device-sdks/java/1.0/api">Java v1.0 APIs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference external" href="https://docs.rs/astarte-device-sdk/latest/astarte_device_sdk/">Rust APIs</a></li>
<li class="toctree-l2"><a class="reference external" href="https://pkg.go.dev/github.com/astarte-platform/astarte-device-sdk-go/">Go APIs</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/get_started/zephyr.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <!--
Copyright 2024 SECO Mind Srl

SPDX-License-Identifier: Apache-2.0
-->
<section id="get-started-with-zephyr">
<h1>Get started with Zephyr<a class="headerlink" href="#get-started-with-zephyr" title="Link to this heading">¶</a></h1>
<p>Follow this guide to start with the Astarte device SDK for the Zephyr framework.</p>
<p>We will assume you have already set up Zephyr and are starting with a fresh empty project.
Your starting project should initialize networking using an appropriate physical layer and you
should have added a set of TLS certificates appropriate to reach the Astarte servers.</p>
<section id="add-the-astarte-device-sdk-as-a-dependency">
<h2>Add the Astarte device SDK as a dependency<a class="headerlink" href="#add-the-astarte-device-sdk-as-a-dependency" title="Link to this heading">¶</a></h2>
<p>To add this module as a dependency to an application the application’s manifest file should be
modified in the following way.
First, a new remote should be added:</p>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>  remotes:
    # ... other remotes ...
    - name: astarte-platform
      url-base: https://github.com/astarte-platform
</pre></div>
</div>
<p>Second, a new entry should be added to the projects list:</p>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>  projects:
    # ... other projects ...
    - name: astarte-device-sdk-zephyr
      remote: astarte-platform
      repo-path: astarte-device-sdk-zephyr.git
      path: astarte-device-sdk-zephyr
      revision: v0.7.1
      west-commands: scripts/west-commands.yml
      import: true
</pre></div>
</div>
<p>Remember to run <code class="docutils literal notranslate"><span class="pre">west</span> <span class="pre">update</span></code> after changing the manifest file.</p>
<p>In addition, the Astarte device library <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> should be added to the <code class="docutils literal notranslate"><span class="pre">Kconfig</span></code> file of the
application.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rsource</span> <span class="s2">&quot;../../astarte-device-sdk-zephyr/Kconfig&quot;</span>
</pre></div>
</div>
<p>This will add the configuration options of the example module to the application.</p>
<p>Last, install the dependencies for the west extensions required by the Astarte device, by running
this command in your Zephyr workspace.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>./astarte-device-sdk-zephyr/scripts/requirements.txt
</pre></div>
</div>
</section>
<section id="minimal-configuration-options-for-the-astarte-device">
<h2>Minimal configuration options for the Astarte device<a class="headerlink" href="#minimal-configuration-options-for-the-astarte-device" title="Link to this heading">¶</a></h2>
<p>A minimal set of Zephyr functionalities should be enabled for the Astarte device to work.
Modules such as MbedTLS, base64, and MQTT provide the necessary functionality.</p>
<div class="highlight-conf notranslate"><div class="highlight"><pre><span></span># ... Hardware dependent networking configuration ...

# Astarte device SDK
CONFIG_ASTARTE_DEVICE_SDK=y
CONFIG_ASTARTE_DEVICE_SDK_HOSTNAME=&quot;.&quot;
CONFIG_ASTARTE_DEVICE_SDK_REALM_NAME=&quot;.&quot;
CONFIG_ASTARTE_DEVICE_SDK_PAIRING_JWT=&quot;.&quot;
# Assuming that HTTPs and MQTTs requests can use the same TLS certificate
# The two following tags should correspond to the certificates added by the user
CONFIG_ASTARTE_DEVICE_SDK_HTTPS_CA_CERT_TAG=1
CONFIG_ASTARTE_DEVICE_SDK_MQTTS_CA_CERT_TAG=1
# This tag should correspond to an unused certificate tag.
# The Astarte device will use it to store the client certificate.
CONFIG_ASTARTE_DEVICE_SDK_CLIENT_CERT_TAG=2
# This example will not include permanent storage
CONFIG_ASTARTE_DEVICE_SDK_PERMANENT_STORAGE=n

# Enable logging for application
CONFIG_LOG=y

# Increased stack size
CONFIG_MAIN_STACK_SIZE=16384

# DNS resolver
CONFIG_DNS_RESOLVER=y
CONFIG_DNS_SERVER_IP_ADDRESSES=y
CONFIG_DNS_SERVER1=&quot;8.8.8.8&quot; # Google DNS

# Enable entropy generator
CONFIG_ENTROPY_GENERATOR=y

# Enable JSON library
CONFIG_JSON_LIBRARY=y

# Enable base64 encoding and decoding
CONFIG_BASE64=y

# Enable system hashmaps
CONFIG_SYS_HASH_MAP=y
CONFIG_SYS_HASH_FUNC32=y

# Sockets
CONFIG_NET_SOCKETS=y
CONFIG_NET_SOCKETS_SOCKOPT_TLS=y

# Enable HTTP client
CONFIG_HTTP_CLIENT=y

# MQTT options
CONFIG_MQTT_LIB=y
CONFIG_MQTT_LIB_TLS=y

# MbedTLS
CONFIG_MBEDTLS=y
CONFIG_MBEDTLS_ENABLE_HEAP=y
# 55kB is the max absolute value, could be set much lower
CONFIG_MBEDTLS_HEAP_SIZE=55000
# 16384 is the max absolute value, could be set much lower
CONFIG_MBEDTLS_SSL_MAX_CONTENT_LEN=16384
CONFIG_MBEDTLS_PEM_CERTIFICATE_FORMAT=y # Does not include writing
CONFIG_MBEDTLS_PK_WRITE_C=y # Required for PEM writing (also needs MBEDTLS_PEM_WRITE_C)
CONFIG_MBEDTLS_X509_CSR_WRITE_C=y
CONFIG_MBEDTLS_USER_CONFIG_ENABLE=y
CONFIG_MBEDTLS_USER_CONFIG_FILE=&quot;../samples/astarte_app/include/tls-conf.h&quot;
CONFIG_MBEDTLS_ENTROPY_ENABLED=y
CONFIG_MBEDTLS_ZEPHYR_ENTROPY=y
CONFIG_MBEDTLS_TLS_VERSION_1_2=y
CONFIG_MBEDTLS_CIPHER=y
CONFIG_MBEDTLS_CIPHER_ALL_ENABLED=y
CONFIG_MBEDTLS_SERVER_NAME_INDICATION=y
CONFIG_MBEDTLS_KEY_EXCHANGE_ALL_ENABLED=y
CONFIG_MBEDTLS_HASH_ALL_ENABLED=y
CONFIG_MBEDTLS_ECDH_C=y
CONFIG_MBEDTLS_ECDSA_C=y
CONFIG_MBEDTLS_ECJPAKE_C=y
CONFIG_MBEDTLS_ECP_C=y
CONFIG_MBEDTLS_ECP_ALL_ENABLED=y
</pre></div>
</div>
</section>
<section id="generate-a-device-id">
<h2>Generate a device ID<a class="headerlink" href="#generate-a-device-id" title="Link to this heading">¶</a></h2>
<p>Each Astarte device is uniquely identified within an Astarte instance using a device ID. Device IDs
can be generated deterministically, starting from user-defined information or randomly.</p>
<p>If you already have a device ID and a credential secret skip to
<a class="reference internal" href="#generating-the-interfaces-headers">Generating the interfaces headers</a>.
This step is only useful when registering the device through the APIs using the JWT token.
When registering a device using an alternative method the device ID should be provided by the user.</p>
<p>To generate a random device ID use the function <code class="docutils literal notranslate"><span class="pre">astarte_device_id_generate_random</span></code> as shown below.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/device_id.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">device_id</span><span class="p">[</span><span class="n">ASTARTE_DEVICE_ID_LEN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_id_generate_random</span><span class="p">(</span><span class="n">device_id</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="registering-a-device">
<h2>Registering a device<a class="headerlink" href="#registering-a-device" title="Link to this heading">¶</a></h2>
<p>For a device to connect to Astarte a registration procedure is required. This registration will
produce a device-specific credential secret that will be used when connecting to Astarte. The Zephyr
Astarte device SDKs provide utilities to perform a device registration directly on the device.
Those utilities require a registration JWT to be loaded on the device. Such JWT should be discarded
following the registration procedure.</p>
<p>This step is only useful when registering the device through the APIs using the JWT token.
Registration of a device can also be performed outside the device in the Astarte instance using
tools such as <a class="reference external" href="https://github.com/astarte-platform/astartectl">astartectl</a>, the
<a class="reference external" href="https://docs.astarte-platform.org/astarte/latest/015-astarte_dashboard.html">Astarte dashboard</a>,
or the dedicated
<a class="reference external" href="https://docs.astarte-platform.org/astarte/latest/api/index.html?urls.primaryName=Pairing%20API">Astarte API for device registration</a>.
The generated credential secret should then be loaded manually on the device.</p>
<p>To generate a credential secret use the function <code class="docutils literal notranslate"><span class="pre">astarte_pairing_register_device</span></code> as shown below.
The JWT should be specified in the Kconfig option <code class="docutils literal notranslate"><span class="pre">CONFIG_ASTARTE_DEVICE_SDK_PAIRING_JWT</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/pairing.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ... Generate a device ID ...</span>

<span class="w">    </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">timeout_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MSEC_PER_SEC</span><span class="p">;</span>
<span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">cred_secr</span><span class="p">[</span><span class="n">ASTARTE_PAIRING_CRED_SECR_LEN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_pairing_register_device</span><span class="p">(</span><span class="n">timeout_ms</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">cred_secr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cred_secr</span><span class="p">));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="generating-the-interfaces-headers">
<h2>Generating the interfaces headers<a class="headerlink" href="#generating-the-interfaces-headers" title="Link to this heading">¶</a></h2>
<p>Each device should define a set of interfaces, defined as introspection, that will be used to
communicate with the Astarte instance.</p>
<p>Since the Astarte interfaces are defined in JSON files, we provide a Python script that
automatically performs the conversion to a compatible C header. It has been configured as a west
extension for this Zephyr module.</p>
<p>Assuming all the interface files are contained in a <code class="docutils literal notranslate"><span class="pre">json_interfaces</span></code> folder it can be run as
follows.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>west<span class="w"> </span>generate-interfaces<span class="w"> </span>--output_dir<span class="w"> </span>./generated_interfaces<span class="w"> </span>./json_interfaces
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">generated_interfaces</span></code> folder should be added to the include search path in the CMake
configuration for your application.
Furthermore, the sources in the <code class="docutils literal notranslate"><span class="pre">generated_interfaces</span></code> folder should be added to your application
CMake target.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>FILE(GLOB generated_interfaces_src ${CMAKE_CURRENT_LIST_DIR}/../generated_interfaces/*.c)
target_sources(app PRIVATE ${generated_interfaces_src})
target_include_directories(app PRIVATE ${CMAKE_CURRENT_LIST_DIR}/../generated_interfaces)
</pre></div>
</div>
<blockquote>
<div><p>NOTE: Remember that the interfaces should be installed in the Astarte
instance for the device to use them.</p>
</div></blockquote>
</section>
<section id="instantiating-a-device">
<h2>Instantiating a device<a class="headerlink" href="#instantiating-a-device" title="Link to this heading">¶</a></h2>
<p>Now that we obtained a credential secret we can create a new device instance.</p>
<p>The Astarte device SDK uses callbacks to communicate to the user that some event has occurred.
Such callbacks should be configured before instantiating the device and connecting to Astarte.
Several callbacks can be optionally configured. A connection callback, an individual data received
callback, an object data received callback, and set property received callback, an unset property
received callback, and a disconnection callback.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/interface.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/device.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;generated_interfaces.h&quot;</span>

<span class="k">static</span><span class="w"> </span><span class="n">K_SEM_DEFINE</span><span class="p">(</span><span class="n">device_connected</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">connection_callback</span><span class="p">(</span><span class="n">astarte_device_connection_event_t</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Astarte device connected.&quot;</span><span class="p">);</span>
<span class="w">	</span><span class="n">k_sem_give</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_connected</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">disconnection_callback</span><span class="p">(</span><span class="n">astarte_device_disconnection_event_t</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Astarte device disconnected&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">k_sem_take</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_connected</span><span class="p">,</span><span class="w"> </span><span class="n">K_NO_WAIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ... generate device ID and register the device with Astarte ...</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">astarte_interface_t</span><span class="w"> </span><span class="o">*</span><span class="n">interfaces</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">org_astarteplatform_zephyr_examples_DeviceAggregate</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">org_astarteplatform_zephyr_examples_DeviceDatastream</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">org_astarteplatform_zephyr_examples_DeviceProperty</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">org_astarteplatform_zephyr_examples_ServerAggregate</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">org_astarteplatform_zephyr_examples_ServerDatastream</span><span class="p">,</span>
<span class="w">        </span><span class="o">&amp;</span><span class="n">org_astarteplatform_zephyr_examples_ServerProperty</span>
<span class="w">	</span><span class="p">};</span>

<span class="w">    </span><span class="n">astarte_device_config_t</span><span class="w"> </span><span class="n">device_config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">http_timeout_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3000</span><span class="p">;</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">mqtt_connection_timeout_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3000</span><span class="p">;</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">mqtt_poll_timeout_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">connection_cbk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection_callback</span><span class="p">;</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">disconnection_cbk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">disconnection_callback</span><span class="p">;</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">interfaces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">interfaces</span><span class="p">;</span>
<span class="w">    </span><span class="n">device_config</span><span class="p">.</span><span class="n">interfaces_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">interfaces</span><span class="p">);</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">device_config</span><span class="p">.</span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="n">device_id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">device_id</span><span class="p">));</span>
<span class="w">    </span><span class="n">memcpy</span><span class="p">(</span><span class="n">device_config</span><span class="p">.</span><span class="n">cred_secr</span><span class="p">,</span><span class="w"> </span><span class="n">cred_secr</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">cred_secr</span><span class="p">));</span>

<span class="w">    </span><span class="n">astarte_device_handle_t</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_config</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="connecting-and-polling-the-device">
<h2>Connecting and polling the device<a class="headerlink" href="#connecting-and-polling-the-device" title="Link to this heading">¶</a></h2>
<p>After device initialization, the device will need to be connected explicitly and polled regularly
to ensure the processing of MQTT messages.
Ideally, a separate thread should be used for polling and transmission.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/device.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="c1">// ... semaphores and callbacks ...</span>

<span class="n">K_THREAD_STACK_DEFINE</span><span class="p">(</span><span class="n">device_rx_thread_stack_area</span><span class="p">,</span><span class="w"> </span><span class="mi">12288</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">k_thread</span><span class="w"> </span><span class="n">device_rx_thread_data</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">device_rx_thread_entry_point</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">device_handle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused1</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused2</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ... generate device ID, register and instantiate the device ...</span>

<span class="w">    </span><span class="n">k_thread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_rx_thread_data</span><span class="p">,</span><span class="w"> </span><span class="n">device_rx_thread_stack_area</span><span class="p">,</span>
<span class="w">        </span><span class="n">K_THREAD_STACK_SIZEOF</span><span class="p">(</span><span class="n">device_rx_thread_stack_area</span><span class="p">),</span><span class="w"> </span><span class="n">device_rx_thread_entry_point</span><span class="p">,</span>
<span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">K_NO_WAIT</span><span class="p">);</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k_sem_count_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_connected</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">k_sleep</span><span class="p">(</span><span class="n">K_MSEC</span><span class="p">(</span><span class="mi">200</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">device_rx_thread_entry_point</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">device_handle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused1</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="n">astarte_device_handle_t</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">astarte_device_handle_t</span><span class="p">)</span><span class="w"> </span><span class="n">device_handle</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_connect</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_poll</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">			</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">k_sleep</span><span class="p">(</span><span class="n">K_MSEC</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="streaming-data">
<h2>Streaming data<a class="headerlink" href="#streaming-data" title="Link to this heading">¶</a></h2>
<p>Streaming of data could be performed for device owned interfaces of <code class="docutils literal notranslate"><span class="pre">individual</span></code> or <code class="docutils literal notranslate"><span class="pre">object</span></code>
aggregation type.</p>
<section id="streaming-individual-data">
<h3>Streaming individual data<a class="headerlink" href="#streaming-individual-data" title="Link to this heading">¶</a></h3>
<p>In Astarte interfaces with <code class="docutils literal notranslate"><span class="pre">individual</span></code> aggregation, each mapping is treated as an independent value
and is managed individually.</p>
<p>The snippet below shows how to send a value that will be inserted into the <code class="docutils literal notranslate"><span class="pre">&quot;/boolean_endpoint&quot;</span></code>
datastream, that is part of <code class="docutils literal notranslate"><span class="pre">&quot;org.astarteplatform.zephyr.examples.DeviceDatastream&quot;</span></code> datastream
interface.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/device.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/individual.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="c1">// ... semaphores, callbacks and transmission thread ...</span>

<span class="n">K_THREAD_STACK_DEFINE</span><span class="p">(</span><span class="n">device_tx_thread_stack_area</span><span class="p">,</span><span class="w"> </span><span class="mi">8192</span><span class="p">);</span>
<span class="k">static</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">k_thread</span><span class="w"> </span><span class="n">device_tx_thread_data</span><span class="p">;</span>
<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">device_tx_thread_entry_point</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">device_handle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused1</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused2</span><span class="p">);</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ... generate device ID, register, instantiate and connect the device ...</span>

<span class="w">    </span><span class="n">k_thread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">device_tx_thread_data</span><span class="p">,</span><span class="w"> </span><span class="n">device_tx_thread_stack_area</span><span class="p">,</span>
<span class="w">        </span><span class="n">K_THREAD_STACK_SIZEOF</span><span class="p">(</span><span class="n">device_tx_thread_stack_area</span><span class="p">),</span><span class="w"> </span><span class="n">device_tx_thread_entry_point</span><span class="p">,</span>
<span class="w">        </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">K_NO_WAIT</span><span class="p">);</span>

<span class="w">	</span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">k_sleep</span><span class="p">(</span><span class="n">K_MSEC</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">device_tx_thread_entry_point</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">device_handle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused1</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>
<span class="w">    </span><span class="n">astarte_device_handle_t</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">astarte_device_handle_t</span><span class="p">)</span><span class="w"> </span><span class="n">device_handle</span><span class="p">;</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">interface_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">org_astarteplatform_zephyr_examples_DeviceDatastream</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1714748755</span><span class="p">;</span>

<span class="w">    </span><span class="n">astarte_individual_t</span><span class="w"> </span><span class="n">boolean_individual</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_individual_from_boolean</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">boolean_path</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/boolean_endpoint&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_stream_individual</span><span class="p">(</span>
<span class="w">        </span><span class="n">device</span><span class="p">,</span><span class="w"> </span><span class="n">interface_name</span><span class="p">,</span><span class="w"> </span><span class="n">boolean_path</span><span class="p">,</span><span class="w"> </span><span class="n">boolean_individual</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">timestamp</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="streaming-aggregated-data">
<h3>Streaming aggregated data<a class="headerlink" href="#streaming-aggregated-data" title="Link to this heading">¶</a></h3>
<p>In Astarte interfaces with <code class="docutils literal notranslate"><span class="pre">object</span></code> aggregation, Astarte expects the owner to send all of the
interface’s mappings at the same time, packed in a single message.</p>
<p>The following snippet shows how to send a value for an object-aggregated interface. In this example,
fourteen different data types will be sent together and will be inserted into the <code class="docutils literal notranslate"><span class="pre">&quot;/sensor24&quot;</span></code>
datastream which is defined by the <code class="docutils literal notranslate"><span class="pre">&quot;/%{sensor_id}&quot;</span></code> endpoint, which is part of
<code class="docutils literal notranslate"><span class="pre">&quot;org.astarteplatform.zephyr.examples.DeviceDatastream&quot;</span></code> datastream interface.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/device.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/object.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="c1">// ... semaphores, callbacks, transmission and reception thread, main program ...</span>

<span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">device_tx_thread_entry_point</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">device_handle</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused1</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">unused2</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>
<span class="w">    </span><span class="n">astarte_device_handle_t</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">astarte_device_handle_t</span><span class="p">)</span><span class="w"> </span><span class="n">device_handle</span><span class="p">;</span>

<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">utils_binary_blob_data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x53</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3d</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">binblob_1</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x53</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x56</span><span class="p">,</span><span class="w"> </span><span class="mh">0x73</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="p">,</span><span class="w"> </span><span class="mh">0x47</span><span class="p">,</span><span class="w"> </span><span class="mh">0x38</span><span class="p">,</span><span class="w"> </span><span class="mh">0x3d</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="n">binblob_2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mh">0x64</span><span class="p">,</span><span class="w"> </span><span class="mh">0x32</span><span class="p">,</span><span class="w"> </span><span class="mh">0x39</span><span class="p">,</span><span class="w"> </span><span class="mh">0x79</span><span class="p">,</span><span class="w"> </span><span class="mh">0x62</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">utils_binary_blobs_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">binblob_1</span><span class="p">,</span><span class="w"> </span><span class="n">binblob_2</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">utils_binary_blobs_sizes_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">binblob_1</span><span class="p">),</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">binblob_2</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">utils_boolean_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">utils_boolean_array_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">utils_unix_time_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1710940988984</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">utils_unix_time_array_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1710940988984</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">utils_double_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">15.42</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">utils_double_array_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">1542.25</span><span class="p">,</span><span class="w"> </span><span class="mf">88852.6</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">utils_integer_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="w"> </span><span class="n">utils_integer_array_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">4525</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">utils_longinteger_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8589934592</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">utils_longinteger_array_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">8589930067</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="mi">8589934592</span><span class="w"> </span><span class="p">};</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">utils_string_data</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello world!&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">utils_string_array_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Hello &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;world!&quot;</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="n">astarte_object_entry_t</span><span class="w"> </span><span class="n">entries</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;binaryblob_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_binaryblob</span><span class="p">(</span>
<span class="w">                </span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_binary_blob_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_binary_blob_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;binaryblobarray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_binaryblob_array</span><span class="p">((</span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="w"> </span><span class="n">utils_binary_blobs_data</span><span class="p">,</span>
<span class="w">                </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_binary_blobs_sizes_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_binary_blobs_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;boolean_endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_individual_from_boolean</span><span class="p">(</span><span class="n">utils_boolean_data</span><span class="p">)),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;booleanarray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_boolean_array</span><span class="p">(</span>
<span class="w">                </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_boolean_array_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_boolean_array_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;datetime_endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_individual_from_datetime</span><span class="p">(</span><span class="n">utils_unix_time_data</span><span class="p">)),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;datetimearray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_datetime_array</span><span class="p">(</span>
<span class="w">                </span><span class="p">(</span><span class="kt">int64_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_unix_time_array_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_unix_time_array_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;double_endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_individual_from_double</span><span class="p">(</span><span class="n">utils_double_data</span><span class="p">)),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;doublearray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_double_array</span><span class="p">(</span>
<span class="w">                </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_double_array_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_double_array_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;integer_endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_individual_from_integer</span><span class="p">(</span><span class="n">utils_integer_data</span><span class="p">)),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;integerarray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_integer_array</span><span class="p">(</span>
<span class="w">                </span><span class="p">(</span><span class="kt">int32_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_integer_array_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_integer_array_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;longinteger_endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_individual_from_longinteger</span><span class="p">(</span><span class="n">utils_longinteger_data</span><span class="p">)),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;longintegerarray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_longinteger_array</span><span class="p">((</span><span class="kt">int64_t</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">utils_longinteger_array_data</span><span class="p">,</span>
<span class="w">                </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_longinteger_array_data</span><span class="p">))),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;string_endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_individual_from_string</span><span class="p">(</span><span class="n">utils_string_data</span><span class="p">)),</span>
<span class="w">        </span><span class="n">astarte_object_entry_new</span><span class="p">(</span><span class="s">&quot;stringarray_endpoint&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">astarte_individual_from_string_array</span><span class="p">(</span>
<span class="w">                </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="p">)</span><span class="w"> </span><span class="n">utils_string_array_data</span><span class="p">,</span><span class="w"> </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">utils_string_array_data</span><span class="p">))),</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_stream_aggregated</span><span class="p">(</span><span class="n">device</span><span class="p">,</span>
<span class="w">        </span><span class="n">org_astarteplatform_zephyr_examples_DeviceAggregate</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/sensor24&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">entries</span><span class="p">,</span>
<span class="w">        </span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">entries</span><span class="p">),</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="setting-and-unsetting-properties">
<h2>Setting and unsetting properties<a class="headerlink" href="#setting-and-unsetting-properties" title="Link to this heading">¶</a></h2>
<p>Interfaces of the <code class="docutils literal notranslate"><span class="pre">property</span></code> type represent a persistent, stateful, synchronized state with no
concept of history or timestamping. From a programming point of view, setting and unsetting
properties of device-owned interfaces is rather similar to sending messages on datastream
interfaces.</p>
<p>In this simple get started persistency for the properties has been disabled. See the more complete
code examples in the GitHub repository for more information on how to set up the appropriate flash
partition.</p>
</section>
<section id="disconnecting-the-device">
<h2>Disconnecting the device<a class="headerlink" href="#disconnecting-the-device" title="Link to this heading">¶</a></h2>
<p>The Astarte device can be gracefully disconnected by Astarte using the disconnect function.
This function will trigger a callback to one of the user-defined functions.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/device.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;astarte_device_sdk/result.h&gt;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">	</span><span class="n">astarte_result_t</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// ... generate device ID, register, instantiate and connect the device ...</span>

<span class="w">    </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">astarte_device_disconnect</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">ASTARTE_RESULT_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">		</span><span class="n">LOG_INF</span><span class="p">(</span><span class="s">&quot;Err: &#39;%s&#39;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">astarte_result_to_name</span><span class="p">(</span><span class="n">res</span><span class="p">));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../features_def.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Features definition</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="rust.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Get started with Rust</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024 SECO Mind Srl
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Get started with Zephyr</a><ul>
<li><a class="reference internal" href="#add-the-astarte-device-sdk-as-a-dependency">Add the Astarte device SDK as a dependency</a></li>
<li><a class="reference internal" href="#minimal-configuration-options-for-the-astarte-device">Minimal configuration options for the Astarte device</a></li>
<li><a class="reference internal" href="#generate-a-device-id">Generate a device ID</a></li>
<li><a class="reference internal" href="#registering-a-device">Registering a device</a></li>
<li><a class="reference internal" href="#generating-the-interfaces-headers">Generating the interfaces headers</a></li>
<li><a class="reference internal" href="#instantiating-a-device">Instantiating a device</a></li>
<li><a class="reference internal" href="#connecting-and-polling-the-device">Connecting and polling the device</a></li>
<li><a class="reference internal" href="#streaming-data">Streaming data</a><ul>
<li><a class="reference internal" href="#streaming-individual-data">Streaming individual data</a></li>
<li><a class="reference internal" href="#streaming-aggregated-data">Streaming aggregated data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-and-unsetting-properties">Setting and unsetting properties</a></li>
<li><a class="reference internal" href="#disconnecting-the-device">Disconnecting the device</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    </body>
</html>